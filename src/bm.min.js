(function(){window.onload=function(){BM.init()};var BM=window.BM={ticker:null,stage:null,tween:Hilo.Tween,asset:null,scenes:{},particleSystem:null,pos:4,land:null,s1Ready:false,s1NeedRunned:false,s3Ready:false,s3NeedRunned:false,s4Ready:false,s4NeedRunned:false,s5Ready:false,s5NeedRunned:false,s6Ready:false,s6NeedRunned:false,s7Ready:false,s7NeedRunned:false,init:function(){var self=this;self.stage=new Hilo.Stage({renderType:"canvas",container:document.body,width:BM.utils.getWidth(),height:BM.utils.getHeight(),background:"#e3ece9"});self.ticker=new Hilo.Ticker(30);self.ticker.addTick(self.stage);self.ticker.addTick(self.tween);self.ticker.start();self.asset=new BM.Asset();var loading=new BM.Loading();self.asset.on("stage1",function(){loading.stop();self.stage.removeChild(loading);self.startFlow()});self.asset.on("stage2",function(){self.s1Ready=true;if(self.s1NeedRunned){self.loadNext(this.curStageId)}});self.asset.on("stage3",function(){self.s3Ready=true;if(self.s3NeedRunned){self.loadNext(this.curStageId)}});self.asset.on("stage4",function(){self.s4Ready=true;if(self.s4NeedRunned){self.loadNext(this.curStageId)}});self.asset.on("stage5",function(){self.s5Ready=true;if(self.s5NeedRunned){self.loadNext(this.curStageId)}});self.asset.on("stage6",function(){self.s6Ready=true;if(self.s6NeedRunned){self.loadNext(this.curStageId)}});self.asset.on("stage7",function(){self.s7Ready=true;if(self.s7NeedRunned){self.loadNext(this.curStageId)}});self.stage.addChild(loading);loading.start();self.asset.load()},startFlow:function(){this.pre=new BM.scenes.Land(this.asset.get("land"));this.stage.addChild(this.pre);this.pre.start()},particle:function(){var self=this;var img=document.getElementById("texture");self.particleSystem&&self.stage.removeChild(self.particleSystem);self.particleSystem=new Hilo.ParticleSystem({x:0,y:0,emitNum:40,emitTime:2,emitterX:0,emitterY:0,particle:{frame:[[0,0,30,30],[30,0,50,20],[50,0,70,20],[30,20,40,30],[40,20,50,30],[50,20,60,30],[60,20,70,30]],image:img,life:150,alphaV:0.1,vxVar:50,vyVar:50,axVar:30,ayVar:30,pivotX:0.5,pivotY:0.5}});self.stage.addChild(self.particleSystem);self.particleSystem.start();self.ticker.addTick({tick:function(){var rand=parseInt(Math.random()*4);if(rand%self.pos===0){self.particleSystem.emitterX=-10;self.particleSystem.emitterY=self.stage.height/2}if(rand%self.pos===1){self.particleSystem.emitterX=self.stage.width+10;self.particleSystem.emitterY=self.stage.height/2}if(rand%self.pos===2){self.particleSystem.emitterX=self.stage.width/2;self.particleSystem.emitterY=-10}if(rand%self.pos===3){self.particleSystem.emitterX=self.stage.width/2;self.particleSystem.emitterY=self.stage.height+10}}})},loadNext:function(nextId){var self=this;if(nextId==="s1"&&!self.s1Ready){self.curStageId=nextId;self.s1NeedRunned=true;return}if(nextId==="s3"&&!self.s3Ready){self.curStageId=nextId;self.s3NeedRunned=true;return}if(nextId==="s4"&&!self.s4Ready){self.curStageId=nextId;self.s4NeedRunned=true;return}if(nextId==="s5"&&!self.s5Ready){self.curStageId=nextId;self.s5NeedRunned=true;return}if(nextId==="s6"&&!self.s6Ready){self.curStageId=nextId;self.s6NeedRunned=true;return}if(nextId==="s7"&&!self.s7Ready){self.curStageId=nextId;self.s7NeedRunned=true;return}if(!nextId){nextId=self.curStageId}self["next"+nextId]=new BM.scenes["next"+nextId](self.asset.get(nextId));self.stage.addChild(self["next"+nextId]);self["next"+nextId].start()}}})();(function(bm){bm.utils={getWidth:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},getHeight:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}})(window.BM);(function(bm){var Asset=bm.Asset=Hilo.Class.create({Mixes:Hilo.EventMixin,firstQueue:null,resStage1:[{id:"land",src:"images/land.jpg"},{id:"square",src:"images/square.png"},{id:"rose",src:"images/rose.png"}],resStage2:[{id:"s1",src:"images/1.jpg"},{id:"s2",src:"images/2.jpg"}],resStage3:[{id:"s3",src:"images/3.jpg"}],resStage4:[{id:"s4",src:"images/4.jpg"}],resStage5:[{id:"s5",src:"images/5.jpg"}],resStage6:[{id:"s6",src:"images/6.jpg"}],resStage7:[{id:"s7",src:"images/7.jpg"}],load:function(){var self=this;self.firstQueue=new Hilo.LoadQueue(this.resStage1);self.firstQueue.maxConnections=4;self.firstQueue.on("complete",function(){self.firstQueue.off("complete");self.fire("stage1");self.stage2()});self.firstQueue.start()},stage2:function(){var self=this;self.firstQueue.add(this.resStage2);self.firstQueue.on("complete",function(){self.firstQueue.off("complete");self.fire("stage2");self.stage3()});self.firstQueue.start()},stage3:function(){var self=this;self.firstQueue.add(this.resStage3);self.firstQueue.on("complete",function(){self.firstQueue.off("complete");self.fire("stage3");self.stage4()});self.firstQueue.start()},stage4:function(){var self=this;self.firstQueue.add(this.resStage4);self.firstQueue.on("complete",function(){self.firstQueue.off("complete");self.fire("stage4");self.stage5()});self.firstQueue.start()
},stage5:function(){var self=this;self.firstQueue.add(this.resStage5);self.firstQueue.on("complete",function(){self.firstQueue.off("complete");self.fire("stage5");self.stage6()});self.firstQueue.start()},stage6:function(){var self=this;self.firstQueue.add(this.resStage6);self.firstQueue.on("complete",function(){self.firstQueue.off("complete");self.fire("stage6");self.stage7()});self.firstQueue.start()},stage7:function(){var self=this;self.firstQueue.add(this.resStage7);self.firstQueue.on("complete",function(){self.firstQueue.off("complete");self.fire("stage7")});self.firstQueue.start()},get:function(id){return this.firstQueue.get(id)},rate:function(){var loaded=this.firstQueue.getLoaded();var total=this.firstQueue.getTotal();if(!total){return"0%"}var rate=parseInt((loaded/total).toFixed(2)*100);return rate+"%"}})})(window.BM);(function(bm){var Loading=bm.Loading=Hilo.Class.create({Extends:Hilo.Text,loadInterval:null,constructor:function(obj){Loading.superclass.constructor.call(this,obj);this.align=Hilo.align.CENTER;this.text="0%";this.color="#2b4716";this.font="40px 微软雅黑";this.width=40;this.height=40},start:function(){var self=this;this.loadInterval=setInterval(function(){self.text=bm.asset.rate()},5)},stop:function(){clearInterval(this.loadInterval)}})})(window.BM);(function(bm){var Text=bm.Text=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,text:null,txt:null,background:"#fff",txtIntr:300,txtUseIntr:false,txtIntrHandle:null,txtNumPerLine:10,txtFontSize:25,txtLineSpacing:3,txtColor:"#779046",txtAlign:"left",txtFontStyle:"楷体",txtX:10,txtY:10,constructor:function(text,type,perline,ext){Text.superclass.constructor.call(this,{});ext=ext||{};this.background=ext.background||this.background;this.txtColor=ext.txtColor||this.txtColor;this.txtFontSize=ext.txtFontSize||this.txtFontSize;this.txtIntr=ext.txtIntr||this.txtIntr;this.txtNumPerLine=perline||this.txtNumPerLine;var wh=this.calContainerWH(text);this.width=wh.w;this.height=wh.h;this.txt=text;this.background=this.background;this.parseType(type)},parseType:function(type){this.type=type||"default";this.txtUseIntr=false;switch(this.type){case"taping":this.txtUseIntr=true;this.x=40;this.y=60;break;case"ltr":this.x=-this.width;this.y=60;this.alpha=0;break;case"rtl":this.x=bm.stage.width;this.y=bm.stage.height-this.height-60;this.alpha=0;break;case"trtl":this.x=bm.stage.width;this.y=60;this.alpha=0;break;case"last":this.x=(bm.stage.width-this.width)/2;this.y=(bm.stage.height-this.height)/2;this.alpha=0;break;default:this.x=40;this.y=60;this.alpha=0;break}},calContainerWH:function(txt){var self=this;if(self.txtNumPerLine>txt.length){self.txtNumPerLine=txt.length}var row=Math.ceil(txt.length/self.txtNumPerLine);return{w:self.txtNumPerLine*self.txtFontSize+2*self.txtX,h:row*self.txtFontSize+3*self.txtY+self.txtLineSpacing*(row-1)}},updateText:function(){var self=this;var index=0;if(self.txtUseIntr){self.intrHandle=setInterval(function(){if(self.txt.length===index){clearInterval(self.intrHandle);return}self.text&&self.removeChild(self.text);self.text=self.createText(self.txt.slice(0,++index));self.addChild(self.text)},self.txtIntr)}},createText:function(txt){var self=this;return new Hilo.Text({maxWidth:self.width-2*self.txtX,text:txt,outline:false,color:self.txtColor,lineSpacing:self.txtLineSpacing,textAlign:self.txtAlign,font:self.txtFontSize+"px "+self.txtFontStyle,x:self.txtX,y:self.txtY})},ready:function(time){switch(this.type){case"taping":this.updateText(time);break;case"ltr":this.animateLTOR(time);break;case"rtl":this.animateRTOL(time);break;case"trtl":this.animateTRTOL(time);break;case"last":default:this.animateDft(time);break}},animateLTOR:function(time){var self=this;self.text=self.createText(self.txt);self.addChild(self.text);bm.tween.to(self,{alpha:1,x:40},{duration:time||2000})},animateRTOL:function(time){var self=this;self.text=self.createText(self.txt);self.addChild(self.text);bm.tween.to(self,{alpha:1,x:bm.stage.width-self.width-40},{duration:time||2000})},hideAnimateRTOL:function(time){var self=this;self.text=self.createText(self.txt);self.addChild(self.text);bm.tween.to(self,{alpha:0},{duration:time||2000,onComplete:function(){self.removeChild(self.text);bm.stage.removeChild(self)}})},animateDft:function(time){var self=this;self.text=self.createText(self.txt);self.addChild(self.text);bm.tween.to(self,{alpha:1},{duration:time||2000})},animateTRTOL:function(time){var self=this;self.text=self.createText(self.txt);self.addChild(self.text);bm.tween.to(self,{alpha:1,x:bm.stage.width-self.width-30},{duration:time||2000})},hideAnimateTRTOL:function(){var self=this;bm.tween.to(self,{alpha:0},{duration:2000,delay:1000,onComplete:function(){bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var Land=bm.scenes.Land=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);
Land.superclass.constructor.call(this,{children:[this.bmp]});this.alpha=0;this.width=this.bmp.width;this.height=this.bmp.height;this.x=-100;this.scaleX=1.4;this.scaleY=1.4},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},start:function(){var self=this;bm.tween.to(self,{x:0,scaleX:1,scaleY:1,alpha:0.8},{duration:3000,ease:self.enterEase,onStart:function(){bm.particle()},onComplete:function(){self.createSquare()}})},createSquare:function(){var self=this;self.square=self.toBitmap(bm.asset.get("square"));self.square.scaleX=0.8;self.square.scaleY=0.8;self.alpha=0.8;self.square.x=(bm.stage.width-self.square.width*0.8)/2;self.square.y=bm.stage.height;bm.stage.addChild(self.square);bm.tween.to(self.square,{y:(bm.stage.height-self.square.height)/2},{duration:1000,ease:self.enterEase,onComplete:function(){self.createLRWords();self.lrTween();self.showFlowers()}})},createLRWords:function(){var self=this;self.left=new Hilo.Text({text:"Marry Me!",font:"30px 微软雅黑",color:"#779046",maxWidth:self.square.width,x:-(bm.stage.width-self.square.width)/2,y:self.square.y+40}).addTo(bm.stage);self.right=new Hilo.Text({text:"My Girl, DONG!",font:"30px 微软雅黑",color:"#779046",maxWidth:self.square.width,x:bm.stage.width,y:self.square.y+120}).addTo(bm.stage)},lrTween:function(){var self=this;bm.tween.to(self.left,{x:(bm.stage.width-120)/2},{duration:1000,delay:5,ease:self.enterEase});bm.tween.to(self.right,{x:(bm.stage.width-200)/2},{duration:1000,delay:5,ease:self.enterEase})},showFlowers:function(){var self=this;self.flower=self.toBitmap(bm.asset.get("rose"));self.flower.x=(bm.stage.width-50)/2;self.flower.y=self.left.y+35;self.flower.scaleX=0.8;self.flower.scaleY=0.8;self.flower.alpha=0;bm.stage.addChild(self.flower);bm.tween.to(self.flower,{alpha:1},{duration:1550,ease:self.enterEase,onComplete:function(){self.showILoveU()}})},showILoveU:function(){var self=this;self.iloveu=new Hilo.Text({text:"I  ❤️  U",font:"30px 微软雅黑",color:"#e23946",alpha:0,x:(bm.stage.width-50)/2,y:self.square.y+200}).addTo(bm.stage);bm.tween.to(self.iloveu,{x:self.iloveu.x-50,alpha:1,scaleX:1.8,scaleY:1.8},{duration:1500,delay:10,ease:self.outEase,onComplete:function(){setTimeout(function(){self.hide();bm.loadNext("s1")},1000)}})},hide:function(){var self=this;bm.tween.to(self.square,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self.square)}});bm.tween.to(this.left,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self.left)}});bm.tween.to(this.flower,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self.flower)}});bm.tween.to(this.right,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self.right)}});bm.tween.to(this.iloveu,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self.iloveu)}});bm.tween.to(this,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var nexts1=bm.scenes.nexts1=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,text:null,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts1.superclass.constructor.call(this,{children:[this.bmp]});this.alpha=0;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},showText:function(){this.text=new bm.Text("2016| 那令我一眼着迷的地方","ltr",12);bm.stage.addChild(this.text);this.text.ready(9000)},start:function(){var self=this;bm.tween.to(self,{alpha:1},{duration:1500,ease:self.enterEase,onStart:function(){bm.particle();self.showText()},onComplete:function(){self.leftToRight()}})},leftToRight:function(){var self=this;bm.tween.to(self,{x:-self.width/3},{duration:5000,ease:self.enterEase,onComplete:function(){self.rightToLeft()}})},rightToLeft:function(){var self=this;bm.tween.to(self,{x:0},{duration:5000,ease:self.enterEase,onComplete:function(){self.hide()}})},hide:function(){var self=this;bm.tween.to(self,{alpha:0.1},{duration:1000,delay:1000,ease:self.outEase,onStart:function(){bm.loadNext("s2")},onComplete:function(){bm.stage.removeChild(self.text);bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var nexts2=bm.scenes.nexts2=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,text:null,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts2.superclass.constructor.call(this,{children:[this.bmp]});this.alpha=0.1;this.scaleX=1.2;this.scaleY=1.2;this.x=-100;this.y=-100;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})
},showText:function(){this.text=new bm.Text("2016| 那迷人的令我沉醉的眼神和脸蛋","rtl",12);bm.stage.addChild(this.text);this.text.ready()},start:function(){var self=this;bm.tween.to(self,{x:0,y:0,depth:1,alpha:1},{duration:3000,delay:100,ease:self.enterEase,onStart:function(){bm.particle();self.showText()},onComplete:function(){self.back()}})},back:function(){var self=this;bm.tween.to(self,{scaleX:1,scaleY:1},{duration:2500,ease:self.enterEase,onComplete:function(){self.hide()}})},hide:function(){var self=this;bm.tween.to(self,{alpha:0},{duration:4500,delay:1000,ease:self.outEase,onStart:function(){self.text.hideAnimateRTOL();bm.loadNext("s3")},onComplete:function(){bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var nexts3=bm.scenes.nexts3=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts3.superclass.constructor.call(this,{children:[this.bmp]});this.x=100;this.alpha=0;this.depth=2;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},showText:function(){this.text=new bm.Text("2016| 我见到天底下最可爱的表情","ltr",12);this.text2=new bm.Text("2016| 也见到天底下最蠢的/[加班狗]","rtl",12);bm.stage.addChild(this.text);bm.stage.addChild(this.text2);this.text.ready(5000);this.text2.ready(5000)},start:function(){var self=this;bm.tween.to(self,{x:-(self.width-bm.stage.width),alpha:1,},{duration:7000,ease:self.enterEase,onStart:function(){bm.particle();self.showText()},onComplete:function(){self.hide()}})},hide:function(){var self=this;bm.tween.to(self,{x:-self.width,alpha:0},{duration:5000,delay:1500,ease:self.outEase,onStart:function(){bm.stage.removeChild(self.text);bm.stage.removeChild(self.text2);bm.loadNext("s4")},onComplete:function(){bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var nexts4=bm.scenes.nexts4=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts4.superclass.constructor.call(this,{children:[this.bmp]});this.x=bm.stage.width;this.alpha=0.2;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},showText:function(){this.text=new bm.Text("2016| 我的宝贝是最漂亮的新娘","rtl",12);bm.stage.addChild(this.text);this.text.ready(7000)},start:function(){var self=this;bm.tween.to(self,{x:-150,alpha:1},{duration:6000,ease:self.enterEase,onStart:function(){bm.particle();self.showText()},onComplete:function(){self.hide()}})},hide:function(){var self=this;bm.tween.to(self,{alpha:0},{duration:1000,delay:1500,ease:self.outEase,onStart:function(){bm.stage.removeChild(self.text);bm.loadNext("s5")},onComplete:function(){bm.stage.removeChild(self);bm.particle()}})}})})(window.BM);(function(bm){var nexts5=bm.scenes.nexts5=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.left=this.toBitmap(bg);this.right=this.toBitmap(bg);nexts5.superclass.constructor.call(this,{children:[this.left,this.right]});this.height=bm.stage.height;this.x=-this.left.width/2;this.background="#000";this.left.x=120;this.left.alpha=0.7;this.right.x=bm.stage.width+this.left.width/2;this.right.alpha=0;this.isFinished=0;this.isHided=0},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},showText:function(){this.text=new bm.Text("2016| 我们玩过, 二过, 闹过也笑过","taping",12,{txtIntr:400,background:"transparent",txtColor:"#fff"});bm.stage.addChild(this.text);this.text.ready()},start:function(){var self=this;bm.tween.to(self.left,{x:this.left.width/2,alpha:1},{duration:7000,ease:self.enterEase,onStart:function(){if(!self.textShowed){self.showText();self.textShowed=true}},onComplete:function(){self.hide()}});bm.tween.to(self.right,{x:this.left.width/2,alpha:0.2},{duration:7000,ease:self.enterEase,onStart:function(){if(!self.textShowed){self.showText();self.textShowed=true}},onComplete:function(){self.hide()}})},hide:function(){var self=this;if(!self.finished()){return}bm.tween.to(self.left,{alpha:0},{duration:5000,delay:2500,ease:self.outEase,onStart:function(){if(!self.hided()){return}bm.stage.removeChild(self.text);bm.loadNext("s6")},onComplete:function(){bm.stage.removeChild(self.left)}});bm.tween.to(self.right,{alpha:0},{duration:5000,delay:2500,ease:self.outEase,onStart:function(){if(!self.hided()){return}bm.stage.removeChild(self.text);bm.loadNext("s6")},onComplete:function(){bm.stage.removeChild(self.right)}})},finished:function(){this.isFinished+=1;
if(this.isFinished!==2){return false}return true},hided:function(){this.isHided+=1;if(this.isHided!==2){return false}return true}})})(window.BM);(function(bm){var nexts6=bm.scenes.nexts6=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts6.superclass.constructor.call(this,{children:[this.bmp]});this.scaleX=0.1;this.scaleY=0.1;this.x=bm.stage.width-100;this.y=bm.stage.height-100;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},showText:function(){this.text=new bm.Text("2017| 希望成为你最温暖的臂膀","trtl",12);bm.stage.addChild(this.text);this.text.ready(3000)},start:function(){var self=this;bm.tween.to(self,{x:0,y:0,scaleX:1,scaleY:1},{duration:5000,ease:self.enterEase,onStart:function(){bm.particle();setTimeout(function(){self.showText()},4000)},onComplete:function(){self.hide()}})},hide:function(){var self=this;bm.tween.to(self,{alpha:0},{duration:5000,delay:3000,ease:self.outEase,onStart:function(){self.text.hideAnimateTRTOL();bm.loadNext("s7")},onComplete:function(){bm.stage.removeChild(self);bm.particle()}})}})})(window.BM);(function(bm){var nexts7=bm.scenes.nexts7=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts7.superclass.constructor.call(this,{children:[this.bmp]});this.alpha=0;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},createSquare:function(){var self=this;self.square=self.toBitmap(bm.asset.get("square"));self.square.scaleX=0.8;self.square.scaleY=0.8;self.square.alpha=0.1;self.square.x=(bm.stage.width-self.square.width*0.8)/2;self.square.y=(bm.stage.height-self.square.height)/2;bm.stage.addChild(self.square);bm.tween.to(self.square,{alpha:0.9},{duration:2000,ease:self.enterEase,onComplete:function(){setTimeout(function(){self.updateText()},500)}})},updateText:function(){var self=this;var index=0;self.txt="亲爱的, 虽然2016我们经常争吵, 但仍未放弃彼此. 缘分就是这么奇妙, 上天眷顾了我让我拥有了你! 2017, 就让老公好好守护你, 爱你, 疼你. 虽不富有但还能靠着双手给你一个家, 一份温暖!";self.intrHandle=setInterval(function(){if(self.txt.length===index){clearInterval(self.intrHandle);return}self.text&&bm.stage.removeChild(self.text);self.text=self.createText(self.txt.slice(0,++index));bm.stage.addChild(self.text)},200)},createText:function(txt){var self=this;return new Hilo.Text({maxWidth:self.square.width*0.8-50,text:txt,outline:false,color:"#779046",lineSpacing:5,textAlign:"left",font:"25px 楷体",x:self.square.x+25,y:self.square.y+20})},start:function(){var self=this;bm.tween.to(self,{alpha:1},{duration:5000,delay:1500,ease:self.enterEase,onComplete:function(){self.createSquare()}})}})})(window.BM);